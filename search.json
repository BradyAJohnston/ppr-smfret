[
  {
    "objectID": "experiments/dye-labelling/dye-labelling.html",
    "href": "experiments/dye-labelling/dye-labelling.html",
    "title": "ppr-smfret",
    "section": "",
    "text": "Codelibrary(tidyverse)\n\nread_spectro <- function(fl) {\n  start <- readLines(fl) |> \n    stringr::str_which(\"Wavelength\")\n  \n  readr::read_csv(\n    file = fl, \n    skip = start - 1, \n    col_select = !contains(\"..\"), \n    col_types = readr::cols()\n    ) |> \n    janitor::clean_names()\n}\n\nchrom_interp_volume <- function(df) {\n  df |> \n    dplyr::select(time, volume) |> \n    unique() |> \n    dplyr::mutate(\n      same = volume != lag(volume), \n      same = dplyr::if_else(is.na(same), TRUE, FALSE), \n      group = cumsum(same)\n    ) |> \n    dplyr::group_by(group, volume) |> \n    tidyr::nest() |> \n    dplyr::ungroup() |> \n    dplyr::mutate(\n      vol_new = lead(volume)\n    ) |> \n    tidyr::unnest() |> \n    dplyr::group_by(volume) |> \n    dplyr::mutate(\n      row = dplyr::row_number(), \n      factor = row / max(row), \n      vol_adjusted = volume + factor * (vol_new - volume)\n    ) |> \n    dplyr::ungroup() |> \n    dplyr::select(time, volume = vol_adjusted)\n}\n\nchrom_read_quadtech <- function(file) {\n  start_line <- readr::read_lines(file, n_max = 50) |>\n    stringr::str_trim() |>\n    stringr::str_which(\"^\\\\d\") |>\n    min()\n  \n  data <-\n    readr::read_csv(file, skip = start_line - 2, col_types = readr::cols())\n  \n  met <-\n    readr::read_csv(\n      file,\n      n_max = start_line - 3,\n      col_names = FALSE,\n      col_types = readr::cols()\n    ) |>\n    dplyr::rename(category = 1, meta = 2)\n  \n  met <- met |>\n    dplyr::filter(str_detect(category, \"Quad\")) |>\n    dplyr::mutate(\n      wl = as.numeric(stringr::str_extract(meta, \"\\\\d{3}\")),\n      channel = as.numeric(stringr::str_extract(category, \"\\\\d$\"))\n    )\n  \n  \n  data <- data |>\n    janitor::clean_names() |>\n    tidyr::pivot_longer(cols = contains(\"quad\")) |>\n    dplyr::mutate(name = as.numeric(str_extract(name, \"\\\\d$\"))) |>\n    dplyr::rename(channel = name) |>\n    dplyr::left_join(met,\n                     by = c(\"channel\" = \"channel\"))\n  \n  volume_interp <- chrom_interp_volume(data)\n  \n  data <- data |>\n    select(-volume) |> \n    left_join(volume_interp, by = c(\"time\" = \"time\"))\n\n  data\n}\n\n\nTo create more of the dsnPPR10-C2 protein that is labelled for smFRET experiments, conducting the labelling of the proteins with new dyes that have been ordered.\nTesting the labelling procedure with 3 different ratios to see which is the best, 1to1, 1to1.5 & 1to2 for ratios of Cy3AF647.\n\n\nCodefl <- here::here(\"data/20220729_dppr10_dye_pre_desalt.csv\")\ndf <- read_spectro(fl)\n\ndf1 <- df |> \n  pivot_longer(\n    cols = -1,\n    names_to = \"sample\", \n    values_to = \"abs\"\n  ) |> \n  mutate(\n    ratio = case_when(\n      str_detect(sample, \"1to?2\") ~ \"1to2\", \n      str_detect(sample, \"1to1_5\") ~ \"1to1.5\", \n      str_detect(sample, \"1to1\") ~ \"1to1\", \n      TRUE ~ \"blank\"\n    ), \n    time = \"pre\", \n    distance = 0.2\n  )\n\nfl <- here::here(\"data/20220729_dppr10_dye_post_desalt.csv\")\ndf <- read_spectro(fl)\n\ndf |> \n  pivot_longer(\n    cols = -1, \n    names_to = \"sample\", \n    values_to = \"abs\"\n  ) |> \n  mutate(\n    distance = str_extract(sample, \"\\\\d(?=m)\"), \n    distance = if_else(is.na(distance), \"2\", distance), \n    distance = as.numeric(distance) * 0.1, \n    time = \"post\"\n  ) -> df\n  \ndf <- df |> \n  mutate(\n    ratio = case_when(\n      str_detect(sample, \"1to2\") ~ \"1to2\", \n      str_detect(sample, \"1to1_5\") ~ \"1to1.5\", \n      str_detect(sample, \"1to1\") ~ \"1to1\", \n      TRUE ~ \"blank\"\n    )\n  )\n\n\nPlotting the absorbance of the different samples, before the desalting step to remove the unbound dyes.\n\nCodedf1 |> \n  filter(ratio != \"blank\") |> \n  ggplot(aes(wavelength_nm, abs, colour = ratio)) + \n  geom_vline(xintercept = c(545, 650), size = 5, alpha = 0.1) + \n  geom_line() + \n  theme_bw() + \n  coord_cartesian(ylim = c(NA, 14)) + \n  theme(\n    legend.position = \"bottom\"\n  ) + \n  labs(x = \"Wavelength (nm)\", \n       y = \"Absorbance (AU)\", \n       colour = \"Cy3:AF647 Ratio\"\n       )\n\n\n\n\nAs you would expect, there is an increasing peaking at 550 nm that corresponds to the increasing amount of acceptor dye that is being added.\n\n\nCodedf |>\n  filter(ratio != \"blank\") |> \n  filter(distance != 0.2) |> \n  ggplot(aes(wavelength_nm, abs, colour = ratio)) + \n  geom_vline(xintercept = c(550, 650), size = 5, alpha = 0.1) + \n  geom_line() + \n  theme_bw() + \n  coord_cartesian(ylim = c(NA, 0.9)) + \n  theme(\n    legend.position = \"bottom\"\n  ) + \n  labs(x = \"Wavelength (nm)\", \n       y = \"Absorbance (AU)\", \n       colour = \"Cy3:AF647 Ratio\"\n       )\n\n\n\n\nThere is much less absorbance in the acceptor peak. The samples also seem a lot ‘pinker’ than they should. Seems that there is a lot less acceptor around, potentially meaning that the dye hasn’t labelled the protein successfully.\n\nCodecdf <- bind_rows(df, df1) |> \n  filter(ratio != \"blank\") |> \n  filter(!(time == \"post\" & distance == 0.2))\n\nwl_range <- function(wl, radius = 2) {\n  seq(wl - radius, wl + radius)\n}\n\n# bin & average wl data\n\nbinned <- cdf |> \n  group_by(time, sample) |> \n  mutate(\n    signal = case_when(\n      wavelength_nm %in% wl_range(280) ~ \"prot\",\n      wavelength_nm %in% wl_range(550) ~ \"don\",\n      wavelength_nm %in% wl_range(650) ~ \"acc\"\n    )\n  ) |> \n  drop_na(signal) |> \n  group_by(sample, time, ratio, distance, signal) |> \n  summarise(\n    abs = mean(abs)\n  )\n\n`summarise()` has grouped output by 'sample', 'time', 'ratio', 'distance'. You\ncan override using the `.groups` argument.\n\nCodebinned <- binned |> \n\n  mutate(\n    ext = case_when(\n      signal == \"prot\" ~ 30955, \n      signal == \"don\" ~ 150000, \n      signal == \"acc\" ~ 265000\n    ), \n    mw = case_when(\n      signal == \"prot\" ~ 69803, \n      signal == \"don\" ~ 666, \n      signal == \"acc\" ~ 1250\n    )\n  ) |> \n  mutate(\n    conc = abs / ext / (distance  / 10), \n    volume = case_when(\n      time == \"pre\" ~ 1e-3, \n      time == \"post\" ~ 2e-3\n    ), \n    amount = conc * volume, \n    time = factor(time, levels = c(\"pre\", \"post\"))\n  )\n\n\n\n\nCodepos = position_dodge2(width = 0.9)\n\nbinned |> \n  group_by(sample, time, ratio) |> \n  mutate(\n    per_prot = amount / amount[which(signal == \"prot\")]\n  ) |> \n  ggplot(aes(ratio, per_prot, fill = signal)) + \n  geom_col(position = pos) +\n  facet_grid(\n    rows = vars(time),\n    # cols = vars(distance), \n    scales = \"free_y\"\n  ) + \n  theme_bw() + \n  labs(\n    x = \"Cy3 to AF647 Ratio\", \n    y = \"Ratio Dye to Protein\", \n    fill = \"Dye\"\n  ) + \n  theme(\n    legend.position = \"bottom\"\n  ) + \n  geom_label(\n    fill = \"white\",\n    aes(label = round(per_prot, 2)), \n    position = pos\n    )\n\n\n\n\nFor some reason, the acceptor dye (AF647) is very low in the post-labelling.\nI need to make some adjustments, as I don’t think the ratios of the dyes to the protein are quite correct due to the \\(CF_{280}\\) of the two dyes which both will absorb a small amount at 280 nm, false boosting the amount of ‘protein’ that is detected.\nI am thoroughly confused as to why there might be such a significant difference in the labelling success for these dyes. Everything should have been basically the same as it was previously, the only thing that would be different is the age of the protein, but why that would affect a single dye (AF647) I don’t know, so I don’t think that is the actual cause.\nThe only other thing that I can think of that is different, is that the AF647 was previously suspended in Milli-Q water, but this time I dissolved it into 100% DMSO. I will have to double check what I wrote in the lab-book for the previous labelling procedure. I wouldn’t think that it would make a difference, but it seems that it might.\nI still conducted the labelling reaction in 5% DMSO like I did previously, so I still don’t know how it would have made a difference in the final reaction having been solubilised in DMSO and not water despite being soluble in both."
  },
  {
    "objectID": "experiments/dye-labelling/dye-labelling.html#confirming-with-sec",
    "href": "experiments/dye-labelling/dye-labelling.html#confirming-with-sec",
    "title": "ppr-smfret",
    "section": "Confirming with SEC",
    "text": "Confirming with SEC\nIt seems from the spectro readings that there isn’t any AF647 properly attaching to the protein. To confirm this, I’ll do analytical SEC on the Quadtec to see if there is any absorbance from the acceptor AF647 on the protein peak or not.\n\nCodefl <- here::here(\"data/sec/20220801_S200_5150_0.3mlmin_5uLinject_Cy3_1_AF647_2.TXT\")\n\ndf <- chrom_read_quadtech(fl)\n\ndf <- df |>\n  mutate(\n    value = value * 1e3, \n    value = if_else(wl == 650, value - 3, value) # adjust signal for better baseline\n    )\n\ndf |> \n  ggplot(aes(volume, value, colour = factor(wl))) +\n  geom_line() +\n  theme_bw() +\n  coord_cartesian(ylim = c(0, NA), xlim = c(0, 3)) + \n  # scale_x_continuous(expand = expansion(c(0, NA))) +\n  ggrepel::geom_label_repel(\n    data = tribble(\n      ~label, ~volume, ~value, \n      \"Void\", 0.98, 10.5, \n      \"Cy3\", 1.68, 13.5, \n      \"AF647\", 2.27, 24.7, \n      \"Protein\", 1.68, 3.7\n    ), \n    mapping = aes(label = label), \n    colour = \"black\", \n    nudge_x = -0.1, \n    nudge_y = 0.2, \n    family = \"mono\"\n  ) + \n  labs(\n    x = \"Volume (mL)\", \n    y = \"Absorbance (mAU)\", \n    colour = \"Wavelength (nm)\"\n  ) + \n  theme(\n    legend.position = c(0.05, 0.9),\n    legend.justification = c(0, 1), \n    legend.box.background = element_rect(colour = \"black\", fill = \"white\")\n  ) -> plt\n\nplt\n\n\n\nChromatogram of absorbance readings for four (4) different wavelengths (260 nm, 280 nm, 550 nm, 650 nm) from analytical size-exclusion chromatography. 50 \\(\\mu\\)L injection volume. 0.3 mL / min.\n\n\n\n\n\nCodewithr::with_options(\n  list(digits = 2),\n  plotly::ggplotly(\n    p = plt\n    )\n  ) |> \n  plotly::layout(\n    # title = \"test\", \n    legend = list(\n      x = 0.05,\n      y = 0.9,\n      xanchor = 1,\n      yanchor = 0, \n      bordercolor = gray(0.3, alpha = 0.3), \n      borderwidth = 1.5\n    ),\n    hovermode = 'x', \n    tooltip = list()\n  )"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Log Book",
    "section": "",
    "text": "No matching items"
  }
]